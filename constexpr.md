# constexpr

> 常量表达式

常量表达式是指值不会改变且在编译过程中就能计算出结果的表达式。常见的常量表达式：

* 字面值
* 用常量表达式初始化的 **const** 对象

一个对象（或表达式）是否为常量表达式由它的数据类型和初始值共同决定。

```c++
const int val = 20;          // val 是常量表达式
const int num = val + 1;     // num 是常量表达式

int m = 30;                  // m 不是常量表达式，虽然初始值是字面值但不是 const 对象

const int sz = get_size();   // sz 不是常量表达式，sz 是常量，但其具体值需要在运行时才能计算出
```



判断是否为常量表达式

1. 是否为字面值本身，若不是跳转 2；若是判断为是
2. 是否为 const 对象，若是跳转 3；若不是判断为否
3. 初始值是否为字面值或常量表达式，若是跳转 4；否则判断为否
4. 初始值是否为字面值，若是判断为是；若不是跳转 5
5. 初始值的常量表达式是在编译过程中计算得出，若是则判断为是；否则不是常量表达式



> constexpr 变量

C++11 引入 **constexpr** 变量，加上限定符后，可以由编译器来检查变量的初值是否为常量表达式。声明为 constexpr 的变量一定是个常量，且必须用常量表达式来初始化。

```c++
constexpr int val1 = 20;
constexpr int val2 = val1 + 1;
constexpr int sz = size();      // 只有当 size() 函数是一个 constexpr 函数时才是正确的语句
```

简单来说，限定符加上后，不需要程序员自己来判断等号右边的是否为常量表达式，而是由编译器帮忙检查。



【小结】

作为程序员在写程序时，你认定一个变量应该被定义为常量表达式，就将其声明为 constexpr 。